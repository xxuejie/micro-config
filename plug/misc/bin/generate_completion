#!/usr/bin/env python3

import sys
import re

if len(sys.argv) < 2:
  print(f"Usage: {sys.argv[0]} --prefix <completion prefix> <path to source files...>")
  sys.exit(1)

sys.argv.pop(0)

prefix = ""
if sys.argv[0] == "--prefix" and len(sys.argv) >= 3:
  prefix = sys.argv[1]
  sys.argv.pop(0)
  sys.argv.pop(0)

candidates = set()
for filename in sys.argv:
  with open(filename, encoding = "utf8") as f:
    for line in f:
      for candidate in re.findall(r'[A-Za-z0-9_]+', line):
        if candidate.startswith(prefix):
          candidates.add(candidate[len(prefix):])

for candidate in sorted(list(candidates)):
  print(candidate)
